<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…¨æ–¹ä½å¥åº·ç®¡ç†ç®¡å®¶</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .period-active { border: 2px solid #ff99bb !important; background-color: #fff0f5 !important; }
        .today-btn { background-color: #4a90e2 !important; color: white !important; }
        .hidden { display: none; }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 pb-10">

    <div class="bg-white shadow-sm sticky top-0 z-10 p-4 border-b">
        <div class="max-w-md mx-auto flex justify-between items-center">
            <div>
                <h1 id="displayDate" class="text-xl font-bold text-blue-600 cursor-pointer">2024-01-01</h1>
                <p class="text-xs text-gray-500">é»æ“Šæ—¥æœŸå¯åˆ‡æ› | <span id="periodDayText" class="text-pink-500 font-bold"></span></p>
            </div>
            <button onclick="jumpToToday()" class="bg-blue-100 text-blue-600 px-3 py-1 rounded-full text-sm font-medium">å›ä»Šå¤©</button>
        </div>
    </div>

    <div class="max-w-md mx-auto p-4 space-y-6">

        <div class="bg-pink-50 p-4 rounded-2xl border border-pink-100">
            <div class="flex justify-between items-center mb-2">
                <span class="font-bold text-pink-700">ç”Ÿç†æœŸæ¨¡å¼</span>
                <label class="relative inline-flex items-center cursor-pointer">
                    <input type="checkbox" id="periodToggle" class="sr-only peer" onchange="updatePeriodStatus()">
                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-pink-500"></div>
                </label>
            </div>
            <p class="text-xs text-pink-600 leading-relaxed">é–‹å•Ÿå¾Œæœƒè‡ªå‹•è¨ˆç®—ç¬¬å¹¾å¤©ï¼Œä¸¦åœ¨æ—¥æ›†æ¨™è¨˜ç´…æ¡†ï¼ŒåŒæ™‚å¢åŠ ç´„ 200 å¤§å¡ç†±é‡ç·©è¡ã€‚</p>
        </div>

        <div class="bg-white p-4 rounded-2xl shadow-sm border">
            <h2 class="font-bold mb-3 flex items-center">âš–ï¸ é«”é‡ç´€éŒ„</h2>
            <div class="grid grid-cols-2 gap-3 mb-3">
                <div class="space-y-1">
                    <span class="text-xs text-gray-500">ç´€éŒ„ 1</span>
                    <input type="time" id="wtTime1" class="w-full text-sm border-gray-200 rounded-lg">
                    <input type="number" id="wtVal1" placeholder="kg" class="w-full border-gray-200 rounded-lg p-2 bg-blue-50">
                    <input type="text" id="wtNote1" placeholder="å‚™è¨»(å¦‚:ç©ºè…¹)" class="w-full text-xs border-gray-200 rounded-lg">
                </div>
                <div class="space-y-1">
                    <span class="text-xs text-gray-500">ç´€éŒ„ 2</span>
                    <input type="time" id="wtTime2" class="w-full text-sm border-gray-200 rounded-lg">
                    <input type="number" id="wtVal2" placeholder="kg" class="w-full border-gray-200 rounded-lg p-2 bg-purple-50">
                    <input type="text" id="wtNote2" placeholder="å‚™è¨»(å¦‚:ç¡å‰)" class="w-full text-xs border-gray-200 rounded-lg">
                </div>
            </div>
        </div>

        <div class="grid grid-cols-2 gap-4">
            <div class="bg-white p-4 rounded-2xl shadow-sm border">
                <h2 class="font-bold mb-2">ğŸ’§ ç¸½é£²æ°´é‡</h2>
                <input type="number" id="waterInput" placeholder="ml" class="w-full border-gray-200 rounded-lg p-2 text-blue-600 font-bold">
            </div>
            <div class="bg-white p-4 rounded-2xl shadow-sm border">
                <h2 class="font-bold mb-2">ğŸ“ åœåº¦(cm)</h2>
                <div class="space-y-1">
                    <input type="number" id="waist" placeholder="è…°åœ" class="w-full text-xs border-gray-200 rounded-lg">
                    <input type="number" id="hip" placeholder="è‡€åœ" class="w-full text-xs border-gray-200 rounded-lg">
                    <input type="number" id="thigh" placeholder="è…¿åœ" class="w-full text-xs border-gray-200 rounded-lg">
                </div>
            </div>
        </div>

        <div class="bg-white p-4 rounded-2xl shadow-sm border">
            <h2 class="font-bold mb-2">ğŸƒ é‹å‹•é …ç›®</h2>
            <input type="text" id="exerciseSearch" onkeyup="filterExercise()" placeholder="æœå°‹å‹•ä½œæˆ–éƒ¨ä½(å¦‚:è…¹, è‡€, å•éˆ´)..." class="w-full mb-3 p-2 border-gray-200 rounded-lg bg-gray-50 text-sm">
            
            <div id="exerciseList" class="space-y-3 max-h-60 overflow-y-auto pr-2">
                </div>
            
            <div class="mt-4 pt-4 border-t">
                <p class="text-sm font-medium text-gray-600 mb-2">+ è‡ªå®šç¾©é‹å‹•</p>
                <div class="flex gap-2">
                    <input type="text" id="customExName" placeholder="åç¨±" class="w-1/2 text-xs border-gray-200 rounded-lg">
                    <input type="number" id="customExCal" placeholder="å¤§å¡" class="w-1/4 text-xs border-gray-200 rounded-lg">
                    <button onclick="addCustomExercise()" class="w-1/4 bg-gray-800 text-white text-xs rounded-lg">æ–°å¢</button>
                </div>
            </div>
        </div>

        <div class="bg-white p-4 rounded-2xl shadow-sm border">
            <h2 class="font-bold mb-3">ğŸ“Š è¶¨å‹¢åˆ†æ</h2>
            <div class="flex gap-2 mb-4">
                <button onclick="drawChart('weight')" class="flex-1 py-1 bg-gray-100 rounded-lg text-sm">é«”é‡</button>
                <button onclick="drawChart('water')" class="flex-1 py-1 bg-gray-100 rounded-lg text-sm">é£²æ°´</button>
            </div>
            <canvas id="trendChart" height="200"></canvas>
        </div>

        <button onclick="saveAll()" class="w-full bg-blue-600 text-white py-4 rounded-2xl font-bold shadow-lg shadow-blue-200">å„²å­˜ä»Šæ—¥ç´€éŒ„</button>

    </div>

    <div id="dateModal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center p-6 z-50">
        <div class="bg-white p-6 rounded-3xl w-full max-w-xs text-center">
            <h3 class="font-bold mb-4">é¸å–æ—¥æœŸ</h3>
            <input type="date" id="datePicker" class="w-full p-2 border rounded-xl mb-4">
            <div class="flex gap-2">
                <button onclick="toggleModal()" class="flex-1 py-2 bg-gray-100 rounded-xl">å–æ¶ˆ</button>
                <button onclick="changeDate()" class="flex-1 py-2 bg-blue-600 text-white rounded-xl">ç¢ºå®š</button>
            </div>
        </div>
    </div>

    <script>
        let currentData = {};
        let selectedDate = new Date().toISOString().split('T')[0];

        const exercises = [
            { name: "å•éˆ´è² é‡æ·±è¹²", part: "è…¿è‡€", tool: "å•éˆ´" },
            { name: "å•éˆ´å¤¾èƒ¸", part: "èƒ¸", tool: "å•éˆ´" },
            { name: "å•éˆ´åˆ’èˆ¹", part: "èƒŒ", tool: "å•éˆ´" },
            { name: "å·¦å³å´æŠ¬è…¿", part: "è…¿", tool: "å¾’æ‰‹" },
            { name: "è·ªå¼å‰å¾Œä¿¯è‡¥æ’", part: "è…¹", tool: "å¾’æ‰‹" },
            { name: "ä¿¯è‡¥å¾ŒæŠ¬è…¿", part: "è‡€", tool: "å¾’æ‰‹" },
            { name: "è…³å¿ƒé–‹åˆ", part: "è…¿", tool: "å¾’æ‰‹" },
            { name: "è·ªå§¿å·¦å³æŠ¬è…¿", part: "è…°è…¹", tool: "å¾’æ‰‹" },
            { name: "è·ªå§¿å¾ŒæŠ¬è…¿(ç›´)", part: "ä¸‹è‡€", tool: "å¾’æ‰‹" },
            { name: "è·ªå§¿å½æ›²æŠ¬è…¿", part: "ä¸Šè‡€", tool: "å¾’æ‰‹" },
            { name: "å•éˆ´Wå‹å¤–æ¨", part: "æ‰‹è‡‚", tool: "å•éˆ´" },
            { name: "è‡€æ©‹", part: "è‡€", tool: "å¾’æ‰‹" },
            { name: "å•éˆ´å´å¹³èˆ‰", part: "è‚©", tool: "å•éˆ´" },
            { name: "å•éˆ´ç¡¬æ‹‰", part: "è‡€", tool: "å•éˆ´" },
            { name: "å½ˆåŠ›å¸¶å‰å¾Œç¹è‚©", part: "è‚©èƒŒ", tool: "å½ˆåŠ›å¸¶" },
            { name: "å½ˆåŠ›å¸¶é«˜ä½ä¸‹æ‹‰", part: "è‚©èƒŒ", tool: "å½ˆåŠ›å¸¶" },
            { name: "å½ˆåŠ›å¸¶å·¦å³å´æ‹‰", part: "æ‰‹èƒ¸", tool: "å½ˆåŠ›å¸¶" },
            { name: "å·¦å³è…¿åˆ†è¹²", part: "è‡€", tool: "å•éˆ´" },
            { name: "è…³å°–äº¤å‰é»åœ°", part: "è…¹", tool: "å¾’æ‰‹" },
            { name: "äº¤æ›¿æ”¶è…¿", part: "è…¹", tool: "å¾’æ‰‹" },
            { name: "å±ˆè†æ²è…¹", part: "è…¹", tool: "å¾’æ‰‹" },
            { name: "ç›´è…¿æ²è…¹", part: "è…¹", tool: "å¾’æ‰‹" },
            { name: "è‡ªè¡Œè»Šæ²è…¹", part: "è…¹", tool: "å¾’æ‰‹" },
            { name: "å‰ªåˆ€è…¿", part: "è…¹", tool: "å¾’æ‰‹" }
        ];

        // åˆå§‹åŒ–
        window.onload = function() {
            renderExercises();
            loadDateData(selectedDate);
            document.getElementById('displayDate').addEventListener('click', toggleModal);
            drawChart('weight');
        };

        function renderExercises() {
            const list = document.getElementById('exerciseList');
            list.innerHTML = exercises.map(ex => `
                <div class="exercise-item flex justify-between items-center p-2 bg-gray-50 rounded-lg text-sm" data-name="${ex.name}" data-part="${ex.part}">
                    <div>
                        <div class="font-medium">${ex.name}</div>
                        <div class="text-[10px] text-gray-400">${ex.part} | ${ex.tool}</div>
                    </div>
                    <div class="flex items-center gap-1">
                        <input type="number" placeholder="ä¸‹" class="w-12 p-1 border rounded ex-reps" onchange="saveAuto()">
                        <span class="text-xs">x</span>
                        <input type="number" placeholder="çµ„" class="w-12 p-1 border rounded ex-sets" onchange="saveAuto()">
                    </div>
                </div>
            `).join('');
        }

        function filterExercise() {
            const q = document.getElementById('exerciseSearch').value.toLowerCase();
            document.querySelectorAll('.exercise-item').forEach(item => {
                const text = item.getAttribute('data-name') + item.getAttribute('data-part');
                item.style.display = text.includes(q) ? 'flex' : 'none';
            });
        }

        function loadDateData(date) {
            selectedDate = date;
            document.getElementById('displayDate').innerText = date;
            const data = JSON.parse(localStorage.getItem('health_data_' + date)) || {};
            
            // é«”é‡
            document.getElementById('wtVal1').value = data.wtVal1 || "";
            document.getElementById('wtTime1').value = data.wtTime1 || "";
            document.getElementById('wtNote1').value = data.wtNote1 || "";
            document.getElementById('wtVal2').value = data.wtVal2 || "";
            document.getElementById('wtTime2').value = data.wtTime2 || "";
            document.getElementById('wtNote2').value = data.wtNote2 || "";
            
            // é£²æ°´èˆ‡åœåº¦
            document.getElementById('waterInput').value = data.water || "";
            document.getElementById('waist').value = data.waist || "";
            document.getElementById('hip').value = data.hip || "";
            document.getElementById('thigh').value = data.thigh || "";

            // ç”Ÿç†æœŸ
            const periodStatus = localStorage.getItem('period_start_date');
            document.getElementById('periodToggle').checked = (periodStatus === date);
            updatePeriodText(date);

            // é‹å‹• (ç°¡åŒ–è™•ç†)
            document.querySelectorAll('.ex-reps').forEach(i => i.value = "");
            document.querySelectorAll('.ex-sets').forEach(i => i.value = "");
        }

        function saveAll() {
            const data = {
                wtVal1: document.getElementById('wtVal1').value,
                wtTime1: document.getElementById('wtTime1').value,
                wtNote1: document.getElementById('wtNote1').value,
                wtVal2: document.getElementById('wtVal2').value,
                wtTime2: document.getElementById('wtTime2').value,
                wtNote2: document.getElementById('wtNote2').value,
                water: document.getElementById('waterInput').value,
                waist: document.getElementById('waist').value,
                hip: document.getElementById('hip').value,
                thigh: document.getElementById('thigh').value
            };
            localStorage.setItem('health_data_' + selectedDate, JSON.stringify(data));
            alert('å„²å­˜æˆåŠŸï¼');
            drawChart('weight');
        }

        function updatePeriodStatus() {
            if(document.getElementById('periodToggle').checked) {
                localStorage.setItem('period_start_date', selectedDate);
            } else {
                localStorage.removeItem('period_start_date');
            }
            updatePeriodText(selectedDate);
        }

        function updatePeriodText(date) {
            const startDate = localStorage.getItem('period_start_date');
            const textEl = document.getElementById('periodDayText');
            if(startDate) {
                const diff = Math.floor((new Date(date) - new Date(startDate)) / (1000*60*60*24)) + 1;
                if(diff >= 1 && diff <= 7) {
                    textEl.innerText = `ç”Ÿç†æœŸç¬¬ ${diff} å¤©`;
                    return;
                }
            }
            textEl.innerText = "";
        }

        function jumpToToday() {
            selectedDate = new Date().toISOString().split('T')[0];
            loadDateData(selectedDate);
        }

        function toggleModal() {
            document.getElementById('dateModal').classList.toggle('hidden');
        }

        function changeDate() {
            const newDate = document.getElementById('datePicker').value;
            if(newDate) {
                loadDateData(newDate);
                toggleModal();
            }
        }

        let myChart;
        function drawChart(type) {
            const ctx = document.getElementById('trendChart').getContext('2d');
            if(myChart) myChart.destroy();

            const labels = [];
            const values = [];
            const today = new Date();

            for(let i=6; i>=0; i--) {
                const d = new Date(today);
                d.setDate(d.getDate() - i);
                const ds = d.toISOString().split('T')[0];
                labels.push(ds.slice(5));
                const data = JSON.parse(localStorage.getItem('health_data_' + ds)) || {};
                if(type === 'weight') values.push(data.wtVal1 || null);
                else values.push(data.water || 0);
            }

            myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: type === 'weight' ? 'é«”é‡ (kg)' : 'é£²æ°´ (ml)',
                        data: values,
                        borderColor: type === 'weight' ? '#8884d8' : '#3b82f6',
                        tension: 0.3,
                        fill: false
                    }]
                },
                options: { responsive: true, plugins: { legend: { display: false } } }
            });
        }
    </script>
</body>
</html>
